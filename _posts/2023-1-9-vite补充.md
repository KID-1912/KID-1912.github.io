## 构建生产

### base

开发或生产环境服务的公共基础路径。如：

- 绝对 URL 路径名，例如 `/foo/`
- 完整的 URL，例如 `https://foo.com/`
- 空字符串或 `./`（常用于开发环境）

### splitVendorChunk

通过配置中添加 `splitVendorChunkPlugin` 插件来使用 “分割 Vendor Chunk” 策略，要求 [`build.rollupOptions.output.manualChunks`](https://rollupjs.org/configuration-options/#output-manualchunks) 函数形式使用

```js
// vite.config.js
import { splitVendorChunkPlugin } from 'vite'
export default defineConfig({
  plugins: [splitVendorChunkPlugin()],
})
```

### build.rollupOptions

自定义构建，通过  [rollup build参数](https://rollupjs.org/configuration-options/)

#### 多页面应用

```js
// vite.config.js
const { resolve } = require('path')
const { defineConfig } = require('vite')

module.exports = defineConfig({
  build: {
    rollupOptions: {
      input: {
        main: resolve(__dirname, 'index.html'),
        nested: resolve(__dirname, 'nested/index.html') // 参考rollup笔记
      }
    }
  }
})
```

### build.target

vite 默认 browerlist 构建目标为支持**原生 ESM script** 标签、**原生 ESM 动态导入**、`import.meta` 的浏览器

```
Chrome >=87
Firefox >=78
Safari >=14
Edge >=88
```

`build.target` 可以是vite提供的特殊值：

 `modules` 默认值

`esnext` 假设有原生动态导入支持，并将转译得尽可能小

或有效 [esbuild 目标选项](https://esbuild.github.io/api/#target)：['es2015', 'edge88', 'firefox78', 'chrome87', 'safari14']

### 加载报错

重新部署时，可能会删除之前部署的资源；访问用户尝试导入相应的旧代码块

```js
window.addEventListener('vite:preloadError', (event) => {
  window.reload() // 刷新页面
})
```

### 部署

[部署静态站点 | Vite 中文文档](https://ptymt.cn/guide/static-deploy.html)

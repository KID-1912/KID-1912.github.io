---
layout:     post
title:      NestJs
subtitle:   构建高效、可扩展的 Node.js 服务器端应用的框架。采用模块化架构允许使用任何其他库，为您提供真正的灵活性。
date:       2023-12-6
author:     page
header-img: img/NextJs.png
catalog: true
tags:
    - NodeJs
---

# NestJs

## 创建项目

**Nest命令行创建**

```shell
npm i -g @nestjs/cli
nest new project-name
```

**手动创建**

```shell
npm i --save @nestjs/core @nestjs/common rxjs reflect-metadata
```

### 核心文件

`app.module.t` 应用的根模块

`app.controller.ts` 具有单一路由的基本控制器

`app.service.ts` 具有单一方法的基本服务

`app.controller.spec.ts` 控制器的单元测试文件

`main.ts` 使用核心函数 `NestFactory` 创建 Nest 应用实例的应用入口文件

## Controller

### 路由

控制器负责处理传入的 **requests** 并将 **responses** 返回给客户端，采用 **routing** 机制控制哪个控制器接收哪些请求

```ts
import { Controller, Get, Post } from '@nestjs/common';
import { AppService } from './app.service';
// 路由路径前缀，对路由分组
@Controller('article')
export class AppController {
  constructor(private readonly appService: AppService) {}

  @Get('one') // 请求方法装饰器为 HTTP 请求的特定端点创建处理程序
  // /article/one
  getArticle(): string {
    return this.appService.getArticle();
  }

  @Post()
  editArticle(): string {
    return this.appService.editArticle();
  }
}
```

**请求方法**

所有标准的HTTP 方法装饰器：`@Get()`、`@Post()`、`@Put()`、`@Delete()`、`@Patch()`、`@Options()` 和 `@Head()`；

此外定义了一个 `@All()` 来处理所有HTTP 方法

**路由通配符**

路由路径支持正则的通配符匹配，如 `@Get('article*')`

### 操作响应

默认nest根据请求处理返回的数据类型选择是否自动序列化，且 **状态码** 默认情况下始终为 200，可通过 `@HttpCode()` 装饰器自定义 ;

对于动态状态码，可通过使用库的响应对象上原生响应处理方法，以 `express` 为例：

```ts
@Get()
getArticle(@Res() response): void {
  const data = this.appService.getArticle();
  response.status(400).send(data)
}
```

### 请求对象

通过 `@Req()` 装饰器访问客户端 **request** 的详细信息

```ts
import { Controller, Get, Post, Req, Res } from '@nestjs/common';
import { AppService } from './app.service';
import { Request } from 'express';

@Controller('article')
export class AppController {
  constructor(private readonly appService: AppService) {}
  @Get('one')
  getArticle(@Req() request: Request, @Res() response): void {
    const data = this.appService.getArticle();
    console.log(request)
    response.status(400).send(data)
  }
}
```

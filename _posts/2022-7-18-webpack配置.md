---
layout:     post
title:      webpack配置
subtitle:   针对项目，添加各种配置扩展webpack打包能力
date:       2021-02-15
author:     page
header-img: img/home-bg-geek.jpg
catalog: true
tags:
    - webpack
---

# webpack配置

## 基本配置

### mode

 配置模式， webpack 将使用相应模式的内置优化

自动注入mode对应值为 `process.env.NODE_ENV` 变量至js模块

```js
module.exports = {
  mode: 'development',
};
// 等同于命令 webpack --mode=development
```

### entry

入口文件；

传入字符串或数组，默认单入口 chunk 会被命名为 `main.js`

```js
entry: './src/main.js',
// 或
entry: ['react', 'react-dom', 'redux', 'react-redux'] // 生成引入数组各项的入口chunk
```

传入对象，则属性的键(key)作为 chunk 的名称，值用于描述入口特性

```js
entry: {
  home: './home.js',
  about: './about.js',
  contact: './contact.js',
}
// 或描述值
entry: {
  home: { import: './catalog.js', filename: 'pages/home.js' },
  about: { import: './about.js', filename: 'pages/[name][ext]' },
  shared: ['react', 'react-dom', 'redux', 'react-redux']
}
```

`filename`：默认入口 chunk 的输出文件名是从 output.filename 中提取出来的，但你可以为入口chunk指定自定义的输出文件名

### output

**clean**

输出打包文件前清空 output 目录

**chunkFilename**

运行时按需加载的chunk的名称

默认 `[id].js`（模块id标识或`output.filename`的`[name]`）

**filename**

控制输出 bundle 的名称，单个入口文件仅作为静态名称解析 `filename: 'bundle.js'`

多个入口、代码拆分或引入插件都会创建多个 bundle，需解析为动态名称

```js
// [id] [name] [chunkhash] [contenthash]
filename: '[name].bundle.js',
```

**path**

打包bundle输出根路径

```js
 path: path.resolve(__dirname, 'dist'),
```

**publicPath**

输出目录对应的**公开 URL**

```js
// VUE_APP_RES_URL: http://res.domain.com.cn/
publicPath: process.env.VUE_APP_RES_URL,
```

### devServer

`http://localhost:port/webpack-dev-server` 路径下可访问本地服务静态文件目录

**open**

启动webServer后自动打开浏览器 `open: true`

**port**

配置服务的监听端口号 `port: 8080`

**proxy**

访问配置路径时，指定代理服务

```js
proxy: {
  '/admin': 'http://api.domain.co,.cn'
}
```

**proxy.changeOrigin**

代理时不保留主机头来源

```js
proxy: {
 '/admin': {
   target: 'http://api.domain.co,.cn',
   changeOrigin: true
 }
}
```

**static**

配置提供静态文件服务的目录

```js
static: path.resolve(__dirname, './dist')
```

**https**

使用https协议 `https: true`

**headers**

配置所有响应的头部默认携带字段值

```js
headers: {
  'X-Custom-Foo': 'bar',
  ...
}
```

**client.logging**

`logging: [“info” | "warn" | "error"]` 重载或热模块替换的日志级别

**devMiddleware**

配置 `webpack-dev-middleware` 插件的server资源的中间处理

**historyApiFallback**

配置服务响应404时替代内容，为 `true` 则返回 index.html（可用于vue-router的history模式刷新丢失问题）；

```js
// 匹配路径替换不同响应资源
historyApiFallback: {
  rewrites: [
   { from: /^\/$/, to: '/views/landing.html' },
   { from: /^\/subpage/, to: '/views/subpage.html' },
   { from: /./, to: '/views/404.html' },
  ]
}
```

**onBeforeSetupMiddleware**

所有其他中间件之前执行，该配置具有自定义中间件作用；相关选项 `onAfterSetupMiddleware`

```js
onAfterSetupMiddleware: function (devServer) {
  if (!devServer) {
    throw new Error('webpack-dev-server is not defined');
  }
  // 可用于mock接口，express中间件写法
  devServer.app.get('/some/path', function (req, res) {
    res.json({ custom: 'response' });
  });
}
```

### devtool

控制是否、如何生成 source map

开发环境推荐

`eval` 生成source map，但不映射到原始代码，不能正确的显示行数

`eval-cheap-module-source-map` 源自 loader 的 source map 会得到更好的处理结果

生产环境推荐

`none` 不生成 source map

`source-map`  source map 作为一个单独的文件生成

`hidden-source-map` 与 `source-map` 相同，但不会为 bundle 添加引用注释

## 优化配置

## 插件配置

### HtmlWebpackPlugin

**安装：** `npm i html-webpack-plugin -D`

**基础使用**

```js
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  ...
  plugins: [new HtmlWebpackPlugin()],
};
```

## 内置API

vue-loader

vueLoaderPlugin

historyApiFallback

resolve.alias

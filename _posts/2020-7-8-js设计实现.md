---
layout:     post
title:      JavaScript实现
subtitle:   JavaScript实现常见功能、交互
date:       2020-07-08
author:     page
header-img: img/post-bg-swift2.jpg
catalog: true
tags:
    - JavaScript
---

#### 弹窗

```html
  <!-- 弹窗 -->
  <div id="modal">
    <div class="mask d-flex justify-content-center align-items-center">
      <div class="modal-layer">
        <!-- 弹窗实例 -->
        <!-- 弹窗 1 -->
        <div id="modal_name1" class="modal"></div>
        <!-- 弹窗 2 -->
        <div id="modal_name2" class="modal"></div>
        <!-- 关闭按钮 -->
        <div class="btn btn-close"></div>
      </div>
    </div>
  </div>
```

```less
#modal{
  display: none;
  position: fixed;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  .mask{
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.6);
    .modal-layer{
      position: relative;
      .modal{
        display: none;
        border-radius: 0.12rem;
        background-color: #fff;
      }
    }
  }
}
#modal_name1 { ... }
```

```js
  const $modal = $("#modal");
  const $modal_children = $modal.find(".modal");
  const $btn_close = $modal.find(".btn-close");
  // 开启弹窗
  function openPopup(sel){
    $(sel).show();
    $modal.show();
    // $modal.fadeIn();
  }
  // 跳转到另一弹窗
  function redirectPopup(sel){
    $modal_children.hide();
    $modal.find(sel).show();
  }
  // 关闭所有弹窗
  $btn_close.on("click", function(){
    // $modal.fadeOut();
    resetForm();
    $modal.hide();
    $modal_children.hide();
  })
```

## 倒计时

```js
function startInitTimer() {
  const autoTimer = window.autoTimer;
  const endTime = window.endTime;
  const serverTime = window.serverTime ;
  window.clearInterval(autoInitTimer);
  let diffTimeStamp = serverTime - Date.now();
  return setInterval(() => {
    let correctStamp = Date.now() + diffTimeStamp;
    const needUpdate = correctStamp > endTime;
    // 倒计时结束
    if (needUpdate) {
      window.clearInterval(autoInitTimer);
      ...
      return;
    }
    // 剩余倒计时
    console.log(playEndTimeStamp - correctStamp);
  }, 1000);
}
```

## 自动重试

```js
let retryCount = 0; // 已重试次数
const fetch = async () => {
  try {
    console.log("请求中...");
    const result = await ...;
    retryCount = 0;
    // return result; 可选
  } catch (error) {
    console.log("请求失败");
    if (retryCount === 0) {
      console.log("重新尝试...");
      retryCount = 1;
      const result = await fetch(); 
      // return result; 可选
    }
    console.log("重试次数用尽")
    retryCount = 0;
    throw error;
  }
};
```

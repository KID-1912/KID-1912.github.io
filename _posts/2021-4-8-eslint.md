---
layout:     post
title:      ESLint代码规范
subtitle:   统一代码质量与书写格式的规范
date:       2021-04-08
author:     page
header-img: img/wallhaven-3km3v9_1920x1080.png
catalog: true
tags:
    - webpack
---

# EsLint

对项目代码的统一规范，包括**代码质量**的规范和**代码格式**的规范；

本质上通过eslint限制键值对代码添加限制规则；如 `prefer-const': 'error'` 即强制项目代码使用 `const` 声明变量

## 开始

**安装：**`npm i eslint -D`

**生成配置文件** 

手动创建：文件格式可能是 `.eslintrc.js`，`.eslintrc.yml`，`.eslintrc.json`

命令行创建：

1. `package.json` 的 `scripts` 下新增 `"eslint": "./node_modules/.bin/eslint"`

2. `npm run eslint -- --init` 自定义选项生成配置文件

3. `npm run eslint xx.js` 在指定文件/目录下运行eslint检测

## 配置

```js
// .eslintrc.js
module.exports = {
  root: true,
  env: {
    node: true,
  },
  extends: [
    'plugin:vue/essential',
    '@vue/airbnb',
    '@vue/prettier'
  ],
  parserOptions: {
    parser: 'babel-eslint',
  },
  rules: {
    // 补充
    'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-debugger': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'prefer-const': 'off',
    "no-param-reassign": [2, { "props": false }], // 根据参数访问
    'prettier/prettier': [
      'error',
      {
        tabWidth: 2,//一个tab代表几个空格数
        useTabs: false,//是否使用tab进行缩进，默认为false
        singleQuote: false,//字符串是否使用单引号，默认为false，使用双引号
        trailingComma: 'none',//是否使用尾逗号，有三个可选值"<none|es5|all>"
        bracketSpacing: true,//对象大括号直接是否有空格，默认为true，效果：{ foo: bar }
        printWidth: 100,//一行的字符数，如果超过会进行换行，默认为80
        // 补充
        arrowParens: 'avoid'  // 箭头函数尽量避免括号
      }
    ]
  },
};
```

#### root

eslint支持层叠配置(读取不同层级目录的rc文件)，以检测文件最近的rc作为最高优先级；`root: true` 即当前为根目录配置，停止向上查找

#### env

告诉 ESLint 当前项目支持的运行环境，以便于支持识别不同环境下的全局变量；

如配置 `{ browser: true }` 即浏览器运行环境，自动支持 `window`，`document`变量识别；

常用开启环境：`browser` `node` `commonjs` `es6` `jquery`

#### parse

设置eslint解析器，默认为 `Espree`；其它与Eslint完全兼容的解析器有 `esprima`，`@babel/eslint-parser`，`@typescript-eslint/parser`；

#### parseOptions

 配置JavaScript语言选项，包括ECMAScript 其它版本和 JSX 的支持；配置项：

```js
parseOptions: {
  ecmaVersion: 2019, // ECMAScript版本支持
  sourceType: 'module', // 默认值为script,module即代码为ECMAScript模块
  ecmaFeatures: {  // 语言特性
    globalReturn: false, // 不允许在全局作用域下使用 return
    impliedStrict: true, // 启用全局 strict mode
    jsx: true  // 启用jsx
  },
  // 以下选项作用于@babel/eslint-parser解析器
  requireConfigFile: false, // 没有 babelrc文件，也用@babel/eslint-parser解析
  allowImportExportEverywhere: false // 仅允许 import export 语句出现在模块顶层
}
```

#### extends

当前eslint配置文件继承自其它的规则，值可以为

字符串类型：配置文件的路径、可共享配置的名称、`eslint:recommended`(eslint推荐)

数组：每个配置继承它前面的配置，依次覆盖

常用配置规则：`eslint:recommended` `eslint-config-airbnb` `eslint-plugin-react` `eslint-plugin-vue` `eslint-config-prettier` `eslint-plugin-import` `eslint-config-standard`

**注意：** prettier是一个特殊规范，主要是对代码格式的规范，如括号，逗号，分号等；一般覆盖在最前面

#### plugins

省略写法

#### rules

自定义eslint键值对规则，会覆盖extends中规范；

其值的几种情况：

- 0或 `"off"` ：关闭规则
- 1或 `"warn"` ：开启规则，使用警告级别的错误 (不会导致程序退出)
- 2或 `"error"` ：开启规则，使用错误级别的错误 (当被触发的时候，程序会退出)

**rules编写**

查看ESlLint的[官方rules](https://eslint.org/docs/latest/rules/)限制键名规则；prettier同理；

## ESLint使用

### Vue CLI

Vue CLI创建的项目默认支持eslint，且创建时可选择自定义选项中勾选eslint format，选择使用 `eslint + airbnb` ,再选择 ''独立eslit配置为单个文件""

此时package.json会自动添加以下包

- `@vue/cli-plugin-eslint`

- `@vue/eslint-config-airbnb`

- `eslint-plugin-vue`

- `babel-plugin-import`

在没有某些extends时，如prettier，我们安装对应的npm包，如"prettier"的"@vue/eslint-config-prettier"，然后在extends添加新规范；

  **注：** 安装@vue/eslint-config-prettier报错“未找到eslint-plugin-prettier”，安装该包即可；如果还是报错，尝试安装最新eslint版本；

## 其它

`.prettierrc.js` 将prettier格式规范抽离为独立配置，即规定了项目的代码格式

`.eslintignore` 设置eslint检查的忽略文件

`Prettier` vscode插件支持读取项目下.prettierrc.js文件，在保存代码时自动格式化代码为符合规范的格式

1. 安装 Prettier

2. Vscode 设置 -> 搜索 'JSON' -> 编辑settings.json文件 -> 添加配置
   
   ```json
   "prettier.requireConfig": true,
   "editor.formatOnSave": true,
   "editor.codeActionsOnSave": {
      "source.fixAll.eslint": true
   },
   "eslint.format.enable": true,
   "eslint.probe": [
      "javascript",
      "html",
      "vue"
   ]
   ```

## 规范参考

[京东凹凸实验室规范](https://github.com/o2team/eslint-config-o2team)

[腾讯规范](https://github.com/AlloyTeam/eslint-config-alloy)
